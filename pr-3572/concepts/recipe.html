

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Conda build recipes &mdash; conda build 3.18.4+7.gc4e94ae.dirty documentation</title>
  

  
  
    <link rel="shortcut icon" href="../_static/conda-logo.png"/>
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/custom.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Package naming conventions" href="package-naming-conv.html" />
    <link rel="prev" title="Channels and generating an index" href="generating-index.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> conda build
          

          
          </a>

          
            
            
              <div class="version">
                3.18.4+7.gc4e94ae.dirty
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../install-conda-build.html">Installing and updating conda build</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Concepts</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="channels.html">Conda channels</a></li>
<li class="toctree-l2"><a class="reference internal" href="generating-index.html">Channels and generating an index</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Conda build recipes</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#conda-build-process">Conda build process</a></li>
<li class="toctree-l3"><a class="reference internal" href="#deep-dive">Deep dive</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#templates">Templates</a></li>
<li class="toctree-l4"><a class="reference internal" href="#environments">Environments</a></li>
<li class="toctree-l4"><a class="reference internal" href="#building">Building</a></li>
<li class="toctree-l4"><a class="reference internal" href="#prefix-replacement">Prefix replacement</a></li>
<li class="toctree-l4"><a class="reference internal" href="#testing">Testing</a></li>
<li class="toctree-l4"><a class="reference internal" href="#output-metadata">Output metadata</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#more-information">More information</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="package-naming-conv.html">Package naming conventions</a></li>
<li class="toctree-l2"><a class="reference internal" href="features.html">Features</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#what-is-a-package">What is a “package”?</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#what-about-channels">What about channels</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#building-anaconda-installers">Building Anaconda installers</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../user-guide/index.html">User guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../resources/index.html">Resources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../release-notes.html">Release notes</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">conda build</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">Concepts</a> &raquo;</li>
        
      <li>Conda build recipes</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="conda-build-recipes">
<h1>Conda build recipes<a class="headerlink" href="#conda-build-recipes" title="Permalink to this headline">¶</a></h1>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#conda-build-process" id="id2">Conda build process</a></li>
<li><a class="reference internal" href="#deep-dive" id="id3">Deep dive</a><ul>
<li><a class="reference internal" href="#templates" id="id4">Templates</a></li>
<li><a class="reference internal" href="#environments" id="id5">Environments</a></li>
<li><a class="reference internal" href="#building" id="id6">Building</a></li>
<li><a class="reference internal" href="#prefix-replacement" id="id7">Prefix replacement</a></li>
<li><a class="reference internal" href="#testing" id="id8">Testing</a></li>
<li><a class="reference internal" href="#output-metadata" id="id9">Output metadata</a></li>
</ul>
</li>
<li><a class="reference internal" href="#more-information" id="id10">More information</a></li>
</ul>
</div>
<p>To enable building <a class="reference external" href="https://conda.io/projects/conda/en/latest/user-guide/concepts/packages.html">conda packages</a>, <a class="reference internal" href="../install-conda-build.html#install-conda-build"><span class="std std-ref">install and update conda
and conda build</span></a>.</p>
<p>Building a conda package requires a recipe. Enable building
<a class="reference external" href="https://conda.io/projects/conda/en/latest/user-guide/concepts/packages.html">conda packages</a>, <a class="reference internal" href="../install-conda-build.html#install-conda-build"><span class="std std-ref">install and update conda
and conda build</span></a>. A conda build recipe
is a flat directory that contains the following files:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">meta.yaml</span></code>---A file that contains all the metadata in the
recipe. Only <code class="docutils literal notranslate"><span class="pre">package/name</span></code> and <code class="docutils literal notranslate"><span class="pre">package/version</span></code> are
required.</li>
<li><code class="docutils literal notranslate"><span class="pre">build.sh</span></code>---The script that installs the files for the
package on macOS and Linux. It is executed using the <code class="docutils literal notranslate"><span class="pre">bash</span></code>
command.</li>
<li><code class="docutils literal notranslate"><span class="pre">bld.bat</span></code>---The build script that installs the files for the
package on Windows. It is executed using <code class="docutils literal notranslate"><span class="pre">cmd</span></code>.</li>
<li><code class="docutils literal notranslate"><span class="pre">run_test.[py,pl,sh,bat]</span></code>---An optional Python test file, a
test script that runs automatically if it is part of the recipe.</li>
<li>Optional patches that are applied to the source.</li>
<li>Other resources that are not included in the source and cannot
be generated by the build scripts. Examples are icon files,
readme files and build notes.</li>
</ul>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">When you use the <cite>conda skeleton &lt;skeleton_ref&gt;</cite> command,
the first 3 files---<code class="docutils literal notranslate"><span class="pre">meta.yaml</span></code>, <code class="docutils literal notranslate"><span class="pre">build.sh</span></code>, and
<code class="docutils literal notranslate"><span class="pre">bld.bat</span></code>---are automatically generated for you.</p>
</div>
<div class="section" id="conda-build-process">
<h2><a class="toc-backref" href="#id2">Conda build process</a><a class="headerlink" href="#conda-build-process" title="Permalink to this headline">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">conda-build</span></code> performs the following steps:</p>
<ol class="arabic simple">
<li>Reads the metadata.</li>
<li>Downloads the source into a cache.</li>
<li>Extracts the source into the source directory.</li>
<li>Applies any patches.</li>
<li>Re-evaluates the metadata, if source is necessary to fill any
metadata values.</li>
<li>Creates a build environment and then installs the build
dependencies there.</li>
<li>Runs the build script. The current working directory is the
source directory with environment variables set. The build
script installs into the build environment.</li>
<li>Performs some necessary post-processing steps, such as shebang
and rpath.</li>
<li>Creates a conda package containing all the files in the build
environment that are new from step 5, along with the necessary
conda package metadata.</li>
<li>Tests the new conda package if the recipe includes tests:<ol class="arabic">
<li>Deletes the build environment.</li>
<li>Creates a test environment with the package and its
dependencies.</li>
<li>Runs the test scripts.</li>
</ol>
</li>
</ol>
<p>The <a class="reference external" href="https://github.com/continuumio/conda-recipes">conda-recipes</a> repo
contains example recipes for many conda packages.</p>
<div class="admonition caution">
<p class="first admonition-title">Caution</p>
<p class="last">All recipe files, including <code class="docutils literal notranslate"><span class="pre">meta.yaml</span></code> and build
scripts, are included in the final package archive that is
distributed to users. Be careful not to put sensitive information
such as passwords into recipes where it could be made public.</p>
</div>
<p>The <cite>conda skeleton &lt;skeleton_ref&gt;</cite> command can help to make
skeleton recipes for common repositories, such as <a class="reference external" href="https://pypi.python.org/pypi">PyPI</a>.</p>
</div>
<div class="section" id="deep-dive">
<h2><a class="toc-backref" href="#id3">Deep dive</a><a class="headerlink" href="#deep-dive" title="Permalink to this headline">¶</a></h2>
<p>Let's take a closer look at how conda build uses a recipe
to create a package.</p>
<div class="section" id="templates">
<h3><a class="toc-backref" href="#id4">Templates</a><a class="headerlink" href="#templates" title="Permalink to this headline">¶</a></h3>
<p>When you build a conda package, conda build renders the package
by reading a template in the meta.yaml. See <a class="reference internal" href="../resources/define-metadata.html#jinja-templates"><span class="std std-ref">Templating with Jinja</span></a>.</p>
<p>Templates are filled in using your conda build config,
which shows the matrix of things to build against. The
<code class="docutils literal notranslate"><span class="pre">conda</span> <span class="pre">build</span> <span class="pre">config</span></code> determines how many builds it has to do.
For example, defining a conda_build_config.yaml of the form
and filling it defines a matrix of 4 packages to build:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span><span class="p">:</span>
  <span class="o">-</span> <span class="mf">3.7</span>
  <span class="o">-</span> <span class="mf">2.7</span>
<span class="n">vs</span><span class="p">:</span>
  <span class="o">-</span> <span class="mi">2008</span>
  <span class="o">-</span> <span class="mi">2017</span>
</pre></div>
</div>
<p>After this, conda build determines what the outputs will be.
For example, if your <code class="docutils literal notranslate"><span class="pre">conda</span> <span class="pre">build</span> <span class="pre">config</span></code> indicates that you
want two different versions of Python, conda build will show
you the rendering for each Python version.</p>
</div>
<div class="section" id="environments">
<h3><a class="toc-backref" href="#id5">Environments</a><a class="headerlink" href="#environments" title="Permalink to this headline">¶</a></h3>
<p>To build the package, conda build will make an environment for you
and install all of the build and run dependencies in that environment.
Conda build will indicate where you can successfully build the package.
The prefix will take the form:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>&lt;path to conda&gt;/conda-bld/&lt;package name and string&gt;/h_env_placeholder…
</pre></div>
</div>
<p><a class="reference external" href="https://anaconda.org/conda-forge">Conda-forge</a> downloads your package source and then builds the conda
package in the context of the build environment. For example, you may
direct it to download from a Git repo or pull down a tarball from
another source. See the <a class="reference internal" href="../resources/define-metadata.html#source-section"><span class="std std-ref">Source section</span></a> for more information.</p>
<p>What conda build puts into a package depends on what you put into
the build, host, or run sections. See the <a class="reference internal" href="../resources/define-metadata.html#requirements"><span class="std std-ref">Requirements section</span></a>
for more information.
Conda build will use this information to identify dependencies to
link to and identify the run requirements for the package. This allows
conda build to understand what is needed to install the package.</p>
</div>
<div class="section" id="building">
<h3><a class="toc-backref" href="#id6">Building</a><a class="headerlink" href="#building" title="Permalink to this headline">¶</a></h3>
<p>Once the content is downloaded, conda build runs the build step.
See the <a class="reference internal" href="../resources/define-metadata.html#meta-build"><span class="std std-ref">Build section</span></a> for more information.
The build step runs a script. It can be one that you provided.
See the <a class="reference internal" href="../resources/define-metadata.html#build-script"><span class="std std-ref">Script</span></a> section for more information.</p>
<p>If you do not define the script section, then you can create a
build.sh or a bld.bat file to be run.</p>
</div>
<div class="section" id="prefix-replacement">
<h3><a class="toc-backref" href="#id7">Prefix replacement</a><a class="headerlink" href="#prefix-replacement" title="Permalink to this headline">¶</a></h3>
<p>When the build environment is created, it is in a placeholder prefix.
When the package is all bundled up, the prefix is set to a dummy prefix.
When conda is ready to install the package, it rewrites the dummy
prefix with the correct one.</p>
</div>
<div class="section" id="testing">
<h3><a class="toc-backref" href="#id8">Testing</a><a class="headerlink" href="#testing" title="Permalink to this headline">¶</a></h3>
<p>Once a package is built, conda build will test it. To do this, it
creates another environment and installs the conda package. The form
of this prefix is:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>&lt;path to conda&gt;/conda-bld/&lt;package name + string&gt;/_test_env_placeholder…
</pre></div>
</div>
<p>At this point, conda build has all of the info from the meta.yaml about
what its runtime dependencies are, so those dependencies are installed
as well. This generates a test runner script with a reference to the
testing meta.yaml that is created. See the <a class="reference internal" href="../resources/define-metadata.html#meta-test"><span class="std std-ref">Test section</span></a> for
more information. That file is run for testing.</p>
</div>
<div class="section" id="output-metadata">
<h3><a class="toc-backref" href="#id9">Output metadata</a><a class="headerlink" href="#output-metadata" title="Permalink to this headline">¶</a></h3>
<p>After the package is built and tested, conda build cleans up the
environments created prior and outputs the metadata. The recipe for
the package is also added in the output metadata. The metadata directory
is on the top level of the tarball in the <code class="docutils literal notranslate"><span class="pre">info</span></code> directory.
The metadata contains information about the dependencies of the
package and a list of where all of the files in the package go when
it is installed. Conda reads that metadata when it needs to install.</p>
<p>Running <code class="docutils literal notranslate"><span class="pre">conda</span> <span class="pre">install</span></code> causes conda to:</p>
<blockquote>
<div><ul class="simple">
<li>reach out to the repo data containing the dependencies,</li>
<li>guess the right dependencies,</li>
<li>install a list of packages,</li>
<li>unpack the tarball to look at the info,</li>
<li>verify the file based on metadata in the package, and then</li>
<li>go through each file in the package and puts it in the right location.</li>
</ul>
</div></blockquote>
</div>
</div>
<div class="section" id="more-information">
<h2><a class="toc-backref" href="#id10">More information</a><a class="headerlink" href="#more-information" title="Permalink to this headline">¶</a></h2>
<p>Review <a class="reference internal" href="../resources/define-metadata.html"><span class="doc">Defining metadata (meta.yaml)</span></a> to see a breakdown of the
components of a recipe, including:</p>
<blockquote>
<div><ul class="simple">
<li>package name</li>
<li>package version</li>
<li>descriptive metadata</li>
<li>where to obtain source code</li>
<li>how to test the package</li>
</ul>
</div></blockquote>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="package-naming-conv.html" class="btn btn-neutral float-right" title="Package naming conventions" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="generating-index.html" class="btn btn-neutral float-left" title="Channels and generating an index" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, Anaconda, Inc.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>