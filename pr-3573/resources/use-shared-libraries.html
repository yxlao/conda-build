

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Using shared libraries &mdash; conda build 3.18.5+1.g7e27b74.dirty documentation</title>
  

  
  
    <link rel="shortcut icon" href="../_static/conda-logo.png"/>
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/custom.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Build variants" href="variants.html" />
    <link rel="prev" title="Conda package specification" href="package-spec.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> conda build
          

          
          </a>

          
            
            
              <div class="version">
                3.18.5+1.g7e27b74.dirty
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../install-conda-build.html">Installing and updating conda build</a></li>
<li class="toctree-l1"><a class="reference internal" href="../concepts/index.html">Concepts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user-guide/index.html">User guide</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Resources</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="build-scripts.html">Build scripts (build.sh, bld.bat)</a></li>
<li class="toctree-l2"><a class="reference internal" href="compiler-tools.html">Anaconda compiler tools</a></li>
<li class="toctree-l2"><a class="reference internal" href="define-metadata.html">Defining metadata (meta.yaml)</a></li>
<li class="toctree-l2"><a class="reference internal" href="link-scripts.html">Adding pre-link, post-link, and pre-unlink scripts</a></li>
<li class="toctree-l2"><a class="reference internal" href="make-relocatable.html">Making packages relocatable</a></li>
<li class="toctree-l2"><a class="reference internal" href="package-spec.html">Conda package specification</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Using shared libraries</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#shared-libraries-in-windows">Shared libraries in Windows</a></li>
<li class="toctree-l3"><a class="reference internal" href="#shared-libraries-in-macos-and-linux">Shared libraries in macOS and Linux</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="variants.html">Build variants</a></li>
<li class="toctree-l2"><a class="reference internal" href="commands/index.html">Conda-build CLI reference</a></li>
<li class="toctree-l2"><a class="reference internal" href="style-guide.html">Writing style guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorial-template.html">Tutorial template</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../release-notes.html">Release notes</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">conda build</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">Resources</a> &raquo;</li>
        
      <li>Using shared libraries</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="using-shared-libraries">
<h1>Using shared libraries<a class="headerlink" href="#using-shared-libraries" title="Permalink to this headline">¶</a></h1>
<p>Shared libraries are libraries that are loosely coupled to the
programs and extensions that depend on them. When loading an
executable into memory, an operating system finds all dependent
shared libraries and links them to the executable so that it can
run.</p>
<p>Windows, macOS and Linux all provide a way to build executables
and libraries that contain links to the shared libraries they
depend on, instead of directly linking the libraries themselves.</p>
<div class="section" id="shared-libraries-in-windows">
<h2>Shared libraries in Windows<a class="headerlink" href="#shared-libraries-in-windows" title="Permalink to this headline">¶</a></h2>
<p>Unlike macOS and Linux, Windows does not have the concept of
embedding links into binaries. Instead, Windows depends primarily
on searching directories for matching filenames, as documented in
<a class="reference external" href="https://msdn.microsoft.com/en-us/library/7d83bc18.aspx">Search Path Used by Windows to Locate a DLL</a>.</p>
<p>There is an alternate configuration, called <a class="reference external" href="https://en.wikipedia.org/wiki/Side-by-side_assembly">side-by-side
assemblies</a>,
that requires specification of DLL versions in either an embedded
manifest or an appropriately named XML file alongside the binary
in question. Conda does not currently use side-by-side
assemblies, but it may turn towards that in the future to resolve
complications with multiple versions of the same library on the
same system.</p>
<p>For now, most DLLs are installed into <code class="docutils literal notranslate"><span class="pre">(install</span> <span class="pre">prefix)\\Library\\bin</span></code>.
This path is added to <code class="docutils literal notranslate"><span class="pre">os.environ[&quot;PATH&quot;]</span></code> for all Python processes,
so that DLLs can be located, regardless of the value of the
system's PATH environment variable.</p>
<p>NOTE: PATH is searched from left to right, with the first DLL
name match being picked up, in the absence of a manifest
specifying otherwise. This means that installing software with
other matching DLLs may give you a system that crashes in
unpredictable ways. When troubleshooting or asking for support on
Windows, always consider PATH as a potential source of issues.</p>
</div>
<div class="section" id="shared-libraries-in-macos-and-linux">
<h2>Shared libraries in macOS and Linux<a class="headerlink" href="#shared-libraries-in-macos-and-linux" title="Permalink to this headline">¶</a></h2>
<p>In macOS and Linux, dynamic links are discovered in a similar
manner to the way that Python modules are discovered via
PYTHONPATH, and executables are discovered via PATH. A list of
search locations is made, and then the library objects are
searched for in the search locations. By default, as well as by
design, the system dynamic linker does not have any special
preference for the conda environment <code class="docutils literal notranslate"><span class="pre">lib</span></code> directories.</p>
<p>You can specify both absolute links and relative links. If the
links are absolute paths, such as <code class="docutils literal notranslate"><span class="pre">/Users/jsmith/my_build_env</span></code>,
the library works only on a system where that exact path exists.
Therefore, relative links are preferred in conda packages.</p>
<p>Relative links require a special variable in the link itself:</p>
<ul class="simple">
<li>On Linux, the $ORIGIN variable allows you to specify &quot;relative
to this file as it is being executed&quot;.</li>
<li>On macOS, the variables are:<ul>
<li>&#64;rpath---Allows you to set relative links from the system
load paths.</li>
<li>&#64;loader_path---Equivalent to $ORIGIN.</li>
<li>&#64;executable_path---Supports the Apple <code class="docutils literal notranslate"><span class="pre">.app</span></code> directory
approach, where libraries know where they live relative to
their calling application.</li>
</ul>
</li>
</ul>
<p>Conda build uses &#64;loader_path on macOS and $ORIGIN on Linux
because we install into a common root directory and can assume
that other libraries are also installed into that root. The use
of the variables allows you to build relocatable binaries that
can be built on one system and sent everywhere.</p>
<p>On Linux, <code class="docutils literal notranslate"><span class="pre">conda-build</span></code> modifies any shared libraries or
generated executables to use a relative dynamic link by calling
the patchelf tool. On macOS, the install_name_tool tool is used.</p>
<p>CAUTION: Setting LD_LIBRARY_PATH on Linux or DYLD_LIBRARY_PATH on
macOS can interfere with this because the dynamic linker
short-circuits link resolution by first looking at
LD_LIBRARY_PATH.</p>
<p>EXAMPLE: You install an old version of libcurl into your conda
environment due to some compatibility issues with the code you're
using. Then, you set
<code class="docutils literal notranslate"><span class="pre">export</span> <span class="pre">LD_LIBRARY_PATH=/home/jsmith/envs/curl_env/lib</span></code>. From
that point on, every program that you execute in that session
will favor this libcurl to your system libcurl, because it is now
effectively at the &quot;front&quot; of the dynamic load path.</p>
<p>Including conda environment paths in LD_LIBRARY_PATH or
DYLD_LIBRARY_PATH is not recommended.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="variants.html" class="btn btn-neutral float-right" title="Build variants" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="package-spec.html" class="btn btn-neutral float-left" title="Conda package specification" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, Anaconda, Inc.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>